{
  "ignition": {
    "version": "3.4.0"
  },
  "passwd": {
    "users": [
      {
        "groups": [
          "docker"
        ],
        "name": "core",
        "sshAuthorizedKeys": [
          "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCqRRLLldAbLLbFq9k/6dDXSAPgvKTVJuZOEBCf6X8Vgi0/+6twfkM6oVGzcq3FajLHdyFFaQAYdfce5DcLQi6Tt4kiNm+jZH4f+D6166q/8pnHKY5zQfAqbGCUldkZiGUBPHoqqenDUBEhDvVbGJPo2gh3VbEr+w4kMQDzoCCW+HRphLwEEOwikE7Ls54vDw9iNLmoqUTcOeuOAVs3ui0TTbVTXcvfpga7cH6SJssgeBLeMtkpcbIilXX75qHIvJHCE6qOQWLvA1cdH9nqsjzYii/ydzQpTQydRtFDP12nGrD8W77O+/WkXsXp7R0+7QQoV1OAzzEaMRqA0QIypK2LvloaFow2he6j9H9o/+vQ3qU33/5JdhvpN+BjabByh9QQkW0eei6I1AfzCQ8entpxwUBwaGHOseIARBiT31sTdh06n/hSElysUM7V57rPwq9x4zsSV4C5FAruoCEJYFRW+qJ1UySXcPuKI62eQ0+s82JudF0nwCFGSBMcRUksb3U= mafuyu@natura"
        ]
      }
    ]
  },
  "storage": {
    "directories": [
      {
        "path": "/opt/homelab/systemd",
        "mode": 493
      },
      {
        "path": "/opt/homelab/systemd/portainer",
        "mode": 493
      },
      {
        "path": "/opt/homelab/systemd/traefik",
        "mode": 493
      }
    ],
    "files": [
      {
        "path": "/opt/homelab/systemd/portainer/docker-compose.yml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/2yPQW7EIAxF93MKdqwCUXdFymEc4nZQiB0ZB7W3r0jUSaQJCwT/2f/bFaUkpmDsh30UlJoilvAwZmVRSITSPsakBb4xnKp/vXZcOW/L0dhOZ6znVc+i4CdQsBdcQbxs5CeOM4orHOdwJx49zeji/tn3fWjXrmQYMV+zVQC/0uyQYMw4qGxo3+lTdXX/K7vXqC4zTCNkoNhGQKkoOx1a4OETeVmApjOy64g7IMi/mmK5yE8uOmyUfoL3d+v9BQAA//86NuL3gAEAAA=="
        },
        "mode": 493
      },
      {
        "path": "/opt/homelab/systemd/traefik/docker-compose.yml",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/3ySQW+cMBCF7/srrO0h7QGzzXJYWeJS9dDeKnWrng1+m1gYD5oxbPj3FQsNpElzgzefPc8zbwCLp2jU3f3dTsCDryFmp1Rii4tvpk+lfGsfYJ614V4fbnpHnGRGlPqgzo9Q387nHzd9UTO1Px3M6bB/Rf38ByuKoymK40vwNyr167v6iGirAKeqUWWZ7bz2UVD3jDJxj0/bZrd2fxsOFPoWzx4ztc8Hyzn3MXdUN2AtVDfmTZFpvzlGXcofqUWwVb4MIg9Igljz2CWz/ZnP1dS2Nrq19xvON7WOafAOLHo28U5J46kjgfsyfsXF9iGVFxvkvct0RLoSN+VifYMiJh478jGJvqLS1jmGSGlOh/9T8xNWtiiO66yybEoSWBLbKNOW9YX4atn5+JB8C+qTaO8CaopxEcrPy8qCrRA2G1sc6zkC69SWF70md9vKixzjKYGjDVOUe/wJAAD//yeMCQn8AgAA"
        },
        "mode": 493
      }
    ]
  },
  "systemd": {
    "units": [
      {
        "contents": "[Unit]\nDescription=Layer docker-compose with rpm-ostree\nWants=network-online.target\nAfter=network-online.target\n# We run before `zincati.service` to avoid conflicting rpm-ostree\n# transactions.\nBefore=zincati.service\nConditionPathExists=!/var/lib/%N.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\n# `--allow-inactive` ensures that rpm-ostree does not return an error\n# if the package is already installed. This is useful if the package is\n# added to the root image in a future Fedora CoreOS release as it will\n# prevent the service from failing.\nExecStart=/usr/bin/rpm-ostree install -y --allow-inactive docker-compose\nExecStart=/bin/touch /var/lib/%N.stamp\nExecStart=/bin/systemctl --no-block reboot\n\n[Install]\nWantedBy=multi-user.target",
        "enabled": true,
        "name": "rpm-ostree-install-docker-compose.service"
      },
      {
        "contents": "[Unit]\nDescription=Portainer Admin Container\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nRestart=always\nTimeoutStartSec=0\nRestart=always\nWorkingDirectory=/opt/homelab/systemd/portainer/\nExecStartPre=-/usr/bin/docker-compose down -v\nExecStartPre=-/usr/bin/docker-compose rm -v\nExecStartPre=-/usr/bin/docker-compose pull\nExecStart=/usr/bin/docker-compose up\nExecStop=/usr/bin/docker-compose down -v\n\n[Install]\nWantedBy=multi-user.target\nWantedBy=docker.service",
        "enabled": true,
        "name": "portainer.service"
      },
      {
        "contents": "[Unit]\nDescription=Traefik Router Container\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nRestart=always\nTimeoutStartSec=0\nRestart=always\nWorkingDirectory=/opt/homelab/systemd/traefik/\nExecStartPre=-/usr/bin/docker-compose down -v\nExecStartPre=-/usr/bin/docker-compose rm -v\nExecStartPre=-/usr/bin/docker-compose pull\nExecStart=/usr/bin/docker-compose up\nExecStop=/usr/bin/docker-compose down -v\n\n[Install]\nWantedBy=multi-user.target\nWantedBy=docker.service",
        "enabled": true,
        "name": "traefik.service"
      }
    ]
  }
}
